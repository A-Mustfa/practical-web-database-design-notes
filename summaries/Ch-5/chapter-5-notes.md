# Chapter 5 

### 🎯 الفكرة الأساسية:

النجاح في أي مشروع بيعتمد بشكل كبير على التخطيط والتصميم السليم لقاعدة البيانات، لأن قاعدة البيانات هي العمود الفقري للتطبيق.

---
### 🧠 اقتباس مهم:

> _"لو عندي ساعة لإنقاذ العالم، هقضي أول 50 دقيقة في فهم المشكلة."_ – ألبرت أينشتاين  
> → المقصود هنا إن الفهم الجيد للمشكلة (والبيانات) أهم من التنفيذ السريع.

---
### 📌 أهداف الشابتر:

- توضح خطوات **تخطيط وتصميم قاعدة بيانات ويب** باستخدام مثال حقيقي لمتجر إلكتروني.
    
- توضح كيف نحول احتياجات الأطراف المعنية (Stakeholders) لنموذج بيانات (Data Model).
    

---
### 🧩 تطبيق عملي – _Web Store Example_:

#### الأطراف المعنية (Stakeholders):

1. صاحب المتجر الإلكتروني (Store Owner)
2. العميل أو الزائر للموقع (Customer)

#### المتطلبات الأولية للمتجر:

- العملاء يقدروا يشوفوا المنتجات، يعملوا طلب، ويتابعوا حالة الطلب.
- صاحب المتجر يدير المنتجات والمخزون.
- إمكانية الحصول على تقارير عن أداء المتجر.

---
### 📋 أدوارك كمصمم قاعدة بيانات:

- استلام وتحليل متطلبات البيانات من الأطراف المعنية.
- العمل ضمن فريق يشمل: مطورين، مصممين، ومدير مشروع.
- التركيز في هذا الفصل سيكون فقط على _تخطيط وتصميم قاعدة البيانات_.

---
### 🧭 خطوات التخطيط:

1. **Gather Information** – اجمع المعلومات من أصحاب المصلحة.
2. **Identify Entities and Attributes** – حدد الكيانات وصفاتها.
3. **Identify Relationships** – حدد العلاقات بين الكيانات.
4. **Prepare Conceptual Data Model** – جهز النموذج المفاهيمي للبيانات.

> ملاحظة: ترتيب الخطوات مهم، لأنك مش هتقدر ترسم النموذج المفاهيمي قبل ما تفهم الكيانات والعلاقات، وده كله بيعتمد على فهم طبيعة البيانات.

---
### 🗣️ بداية جمع المعلومات:

- بدأنا نجمع متطلبات صاحب المتجر.
- لاحقًا، هنفكر في احتياجات العملاء.
- المعلومات ممكن تكون جمعتها من لقاءات، استبيانات، أو ملاحظات من المستخدمين المحتملين.

---
## 📌 Notes – Store Owner Requirements

### 🎯 الغرض:

جمع كل البيانات المطلوبة من صاحب المتجر لتصميم قاعدة بيانات تدعم تشغيل المتجر الإلكتروني.

---
### 🛒 أولاً: **تفاصيل المنتجات (Product Details)**

صاحب المتجر بيطلب عرض المنتجات للعملاء، وده معناه إننا محتاجين نخزن التفاصيل دي في قاعدة البيانات:

#### ✅ معلومات أساسية لكل منتج:

- الاسم (Product Name)
- وصف قصير (Short Description)
- وصف تفصيلي (Long Description)
- الحجم، اللون، الوزن
- السعر
- الكمية المتوفرة (Availability)
- صورة المنتج
- تعليقات العملاء
- الخصومات الخاصة (Special Discounts)
- تكلفة الشحن
- الفئات (Categories)

> 💡 _معلومة مهمة:_ بعض الحاجات زي "الفئات" مش Attributes وإنما علاقات (Relationships).

---
### 🔍 ثانيًا: **إمكانية البحث عن المنتجات**

- لازم نخلي المنتج قابل للبحث.
- ممكن نحتاج **كلمات مفتاحية** (Keywords) لتسهيل البحث.
- فكرة تصنيف المنتجات داخل فئات مهمة جدًا.

#### 📂 معلومات الفئات (Categories):

- اسم الفئة
- وصف الفئة
- الفئة الأب (Subcategories)

> ⚠️ _تحذير:_ عدد مستويات التصنيف الفرعي لازم يكون قليل علشان المستخدم ميزهقش من التنقل.

---
### ⚙️ ثالثًا: **الإدارة والتحكم (Product Administration)**

#### 🔐 صلاحيات الإدارة:

- محتاجين صفحة لإضافة منتج جديدة → فقط لصاحب المتجر.
- لازم نعرف هو مين؟ → يعني محتاجين _Owner ID_ و _Password_ (لكن مش هنصممهم دلوقتي).

#### ✏️ تعديل المنتجات:

- تعديل الوصف أو السعر أو الفئة.
- خاصية حذف المنتج (لكن مش فعليًا).

> ✅ _الحل:_ نضيف عمود `status` للمنتج يحدد هل هو "نشط" ولا "محذوف".

---
### 📊 رابعًا: **التقارير والتحليلات**

صاحب المتجر محتاج تقارير زي:

- أكثر المنتجات مبيعًا / الأقل.
- أنواع العملاء اللي اشتروا منتجات معينة.
- هل الخصومات كانت فعالة؟

> ✅ التحقق من إن قاعدة البيانات فيها المعلومات المطلوبة علشان نقدر نعمل التقارير دي لاحقًا.

---
## 📌 Notes – Order & Customer Requirements

### 🧾 أولاً: **تفاصيل الطلبات (Order Details)**

بما إن صاحب المتجر هو اللي هيشحن الطلبات بنفسه، لازم نخزن كل تفاصيل الطلب لضمان:

- تتبّع المبيعات.
- إنشاء تقارير تحليلية.

#### ✅ معلومات الطلب تشمل:

- المنتجات المطلوبة
- الكمية لكل منتج
- الخصومات
- تكلفة الشحن
- الضرائب (لو فيه)
- إجمالي السعر (Total Cost)

---
### 👤 ثانيًا: **بيانات العميل (Customer Details)**

#### ✍️ الحد الأدنى المطلوب من العميل:

- **وسيلة دفع صالحة** (Payment Authorization)
- **عنوان الشحن**

> ⚠️ ملاحظة قانونية: في بعض الدول (زي أوروبا)، **تخزين بيانات العملاء** بيكون محدود جدًا بسبب قوانين الخصوصية (GDPR)، فلازم نستأذن العميل صراحة.

#### ✅ أهم المبادئ:

- كل حقول بيانات العميل لازم تكون **اختيارية**.
- ممنوع نجبر العميل يجاوب على أسئلة غير ضرورية.
- الإيميل آمن ومفيد: علشان إرسال تأكيد الطلب أو تتبّعه.

---
### 🔐 ثالثًا: **تتبع الطلبات (Order Tracking)**

لو عايزين العميل يرجع للموقع ويتابع طلبه:

- لازم نخزن **Customer ID** و **Password** علشان يسجل دخوله.
- يقدر يشوف حالة طلباته السابقة.

---
### 💳 رابعًا: **الدفع الإلكتروني (Payment Processing)**

> ❌ **لا يفضل** تخزين معلومات الدفع في قاعدة البيانات.

#### ✅ الطريقة الأفضل:

- يتم إرسال العميل إلى موقع جهة دفع آمنة (مثل PayPal أو Authorize.net).
- بعد الدفع، النظام يستقبل "مقبول" أو "مرفوض".
- يتم فقط حفظ **نتيجة العملية** داخل الطلب.
#### 🔄 في حالة الدفع المرفوض:

- العميل يقدر يحفظ الطلب أو يرجع له لاحقًا.

---
## 🧠 ملاحظات عامة

- كل البيانات اللي جمعناها هتتحول في الخطوات القادمة إلى:
    - **Entities (كيانات)** مثل: Order, Customer, Product
    - **Attributes (خصائص)** مثل: OrderDate, Quantity, TotalCost

> 🎯 _الخطوة الجاية:_ تحديد الكيانات والعلاقات بينها تمهيدًا لبناء **الموديل المفاهيمي (Conceptual Model).**

---
## 🧱 أولًا: الكيانات والخصائص (Entities & Attributes)

### 🛍️ Product

- ProductName
- ShortDescription
- LongDescription
- Size
- Color
- Weight
- Price
- Availability (quantity on hand)
- Picture
- Comments
- SpecialDiscount
- ShippingCost

### 📂 Category

- CategoryName
- Description

### 👤 Customer

- CustomerName
- Email
- ShippingAddress
- UserID
- Password

### 📦 Order

- ProductsOrdered
- Quantity per Product
- Discounts
- ShippingCost
- Taxes
- TotalCost

---

## 🔁 ثانيًا: تحليل العلاقات (Entity Relationships)

### 1. **Product ↔ Category**

- **كل Category يحتوي على منتج أو أكثر** ✅
- **كل Product ينتمي لفئة واحدة أو أكثر** ✅
- إذًا العلاقة **Many-to-Many**
- سيتم تحويل العلاقة إلى 2 One-to-Many باستخدام **جدول وسيط (Associative Table)**

---
### 2. **Product ↔ Order**

- **كل منتج ممكن يكون في صفر أو أكثر من الطلبات** ✅    
- **كل طلب يجب أن يحتوي على منتج واحد على الأقل** ✅
- العلاقة أيضًا **Many-to-Many**
- وسنعالجها باستخدام جدول وسيط مثل `OrderItem`

---
### 3. **Category ↔ Subcategory**

- الفئة ممكن تحتوي على صفر أو أكثر من الفئات الفرعية ✅
- كل فئة فرعية تنتمي لفئة واحدة فقط ✅
- العلاقة **One-to-Many Recursive**

> بنمثلها بوجود `ParentCategoryID` في جدول الفئات.

---
### 4. **Customer ↔ Order**

- **العميل ممكن يعمل 0 أو أكثر من الطلبات** ✅
- **كل طلب يجب أن يكون مرتبطًا بعميل واحد فقط** ✅
- العلاقة **One-to-Many**

---
## 🧠 ملحوظات ذكية:

- بعض العلاقات مثل Product ↔ Customer **غير مباشرة**، وبتتم من خلال Order.
- استخدام **default category** في Product في حالة تعدد الفئات بيساعد في التقارير.
- استخدام **recursive relationship** في Category بيساعد على بناء هيكل هرمي (مثل فئات فرعية داخل فئات رئيسية).
- التأكد من أن كل علاقة تمت مراجعتها من الاتجاهين، من A → B ومن B → A.